ржЪржорзОржХрж╛рж░ тАФ ржЖржорж┐ ржЖржкржирж╛рж░ рж╕ржм ржирж┐рж░рзНржжрзЗрж╢рж╛ржмрж▓рзА ржзрж░рзЗ ржирж┐рзЯрзЗ ZIP + ржкрзВрж░рзНржмрзЗрж░ рж░рзЛржбржорзНржпрж╛ржк ржжрзБржЯрзЛржЗ ржбрж┐ржЯрзЗржЗрж▓ржнрж╛ржмрзЗ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзЗ ржирж┐рж▓рж╛ржо ржПржмржВ ржПржЦржи **ржкрзНрж░рждрж┐ржЯрж┐ ржлрж┐ржЪрж╛рж░/рж╕рж╛ржм-ржлрж┐ржЪрж╛рж░**тАУржПрж░ ржЬржирзНржп ржПржХржЯрж┐ ржирждрзБржи, рж╕ржорзНржкрзВрж░рзНржг, AI-ready ржПржмржВ ржХрзЛржб-ржХржиржлрзНрж▓рж┐ржХрзНржЯ-ржкрзНрж░рждрж┐рж░рзЛржзрзА рж░рзЛржбржорзНржпрж╛ржк ржжрж┐ржЪрзНржЫрж┐ред
ржирзАржЪрзЗ ржпрж╛ ржкрж╛ржмрзЗржи:

* ржкрзНрж░рждрж┐ржЯрж┐ ржлрж┐ржЪрж╛рж░/рж╕рж╛ржм-ржлрж┐ржЪрж╛рж░рзЗрж░ рж╕рж╛ржоржЧрзНрж░рж┐ржХ ржЕржмрж╕рзНржерж╛ (тЬЕ/тЪая╕П/ЁЯФЬ)
* ржкрзНрж░рждрж┐ржЯрж┐ ржЖржЗржЯрзЗржорзЗрж░ рж╕ржЩрзНржЧрзЗ **ржХрзЛржи ржлрж╛ржЗрж▓/рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░** ржЬрзЬрж┐ржд ржЖржЫрзЗ рждрж╛ рж╕рзНржкрж╖рзНржЯ ржирзЛржЯ (ржпрзЗржЯрж╛ ржХржкрж┐-ржкрзЗрж╕рзНржЯ ржХрж░рзЗ ржХрж╛ржЬ ржХрж░рж╛ AI/ржбрзЗржнрзЗрж▓ржкрж╛рж░ ржмрзБржЭржмрзЗ)
* рж╕рзНржкрж╖рзНржЯ ржирж┐рж░рзНржжрзЗрж╢: ржХрзЛржи ржлрж╛ржЗрж▓ ржХржЦржи **ржорзЛржбрж┐ржлрж╛ржЗ/рж░рж┐ржкрзНрж▓рзЗрж╕/ржбрж┐рж▓рж┐ржЯ** ржХрж░ржмрзЗржи тАФ ржпрж╛рждрзЗ ржЖржЧрзЗрж░ `<script>` ржмрж╛ lifecycle рж╕ржорж╕рзНржпрж╛ ржЖрж░ ржирж╛ рж╣рзЯ
* ржмрж╛ржВрж▓рж╛ + ржЗржВрж░рзЗржЬрж┐ ржХрж┐ржнрж╛ржмрзЗ рж╕рзНржЯрзЛрж░ ржПржмржВ рж░рзЗржирзНржбрж╛рж░ ржХрж░ржмрзЗржи тАФ ржбрж╛ржЯрж╛ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ + UI ржирзЛржЯ
* ржкрж░рзАржХрзНрж╖рж╛рж░ (acceptance) ржЪрзЗржХрж▓рж┐рж╕рзНржЯ ржУ ржЖржЧрзЗрж░ ржнрзБрж▓ржЧрзБрж▓рзЛ ржХрзЛржерж╛рзЯ ржарж┐ржХ ржХрж░рждрзЗ рж╣ржмрзЗ

ржЖржорж┐ analysis ржХрж░рждрзЗ ржЧрж┐рзЯрзЗ ZIP-ржПрж░ address ржбрж╛ржЯрж╛рж╕рзЗржЯ ржУ addressEngine.js ржЦрзБржБржЬрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрж┐ тАФ ржПржЧрзБрж▓рзЛ ржирж┐ржЪрзЗ ржЙрж▓рзНрж▓рзЗржЦ ржХрж░рж▓рж╛ржоред (ржПржЗ ржбржХрж┐ржЙржорзЗржирзНржЯ ржжрзЗржЦрж▓рзЗржЗ ржнржмрж┐рж╖рзНржпрждрзЗрж░ ржХрзЛржирзЛ AI/ржбрзЗржнрзЗрж▓ржкрж╛рж░ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрзЛржб ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ) ред

---

# рзз) рж╕рж╛рж░рж╛ржВрж╢ тАФ ржХрж┐ ржХрж░рждрзЗ ржЪрзЗрзЯрзЗржЫрж┐рж▓рзЗржи ржПржмржВ ржЖржорж┐ ржХрж┐ ржХрж░рж▓рж╛ржо

* ржЖржкржирж┐ ржЪрзЗрзЯрзЗржЫрж┐рж▓рзЗржи KMC-ржПрж░ ржкрзБрж░рзЛ рж╕рж┐рж╕рзНржЯрзЗржо (Counter тЖТ Lab тЖТ Print тЖТ Outsource тЖТ Commission тЖТ Expense ржЗрждрзНржпрж╛ржжрж┐) production-ready, bilingual, audit-safe ржПржмржВ AI-reproducible рж╣рзЛржХред
* ржЖржорж┐ ZIP + ржкрзВрж░рзНржмрзЗрж░ рж░рзЛржбржорзНржпрж╛ржк ржорж┐рж▓рж┐рзЯрзЗ **ржПржХржЯрж┐ Single Source of Truth (SSOT) рж░рзЛржбржорзНржпрж╛ржк** ржирзАржЪрзЗ ржжрж┐рж▓рж╛ржо тАФ ржкрзНрж░рждрж┐ржЯрж┐ ржЕржВрж╢рзЗ ржХрж┐ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржПржмржВ ржХрзЛржи ржХрзЛржи ржлрж╛ржЗрж▓/рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ ржпрзБржХрзНржд рждрж╛ ржЦрзБржм рж╕рзНржкрж╖рзНржЯржнрж╛ржмрзЗ рж▓рж┐ржЦрзЗржЫрж┐ред

---

# рзи) ржкрзНрж░ржзрж╛ржи ржирзАрждрж┐ржорж╛рж▓рж╛ (ржпрзЗржЧрзБрж▓рзЛ ржПржиржлрзЛрж░рзНрж╕ ржХрж░рж╛ ржЖржмрж╢рзНржпржХ)

1. **ржПржХржЯрж┐ржЗ JS ржлрж╛ржЗрж▓ ржжрж┐рзЯрзЗ address / counter UI ржирж┐рзЯржирзНрждрзНрж░ржг** тАФ ржЕржирзНржп ржХрзЛржерж╛ржУ inline JS ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛ржмрзЗ ржирж╛. (ржПржЗ ржирзАрждрж┐ ржЫрж┐рж▓ ржЖржЧрзЗрж░ рж╕ржорзЯрзЗ ржнрж╛ржЩрж╛; ржПржЬржирзНржп dropdown ржмрж╛рж░ржмрж╛рж░ ржнрзЗржЩрзЗ ржпрж╛ржЪрзНржЫрж┐рж▓)
2. **PHP рж╢рзБржзрзБ рж╕рж╛рж░рзНржнрж╛рж░-рж╕рж╛ржЗржб рж░рзЗржирзНржбрж╛рж░/ржбрзЗржЯрж╛ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ ржХрж░ржмрзЗ** тАФ DOM manipulation ржХрж░ржмрзЗржирж╛ред Address ржлрж┐рж▓рзНржб-ржПрж░ JS ржЙржкрж░ PHP re-render ржирж┐рж╖рж┐ржжрзНржзред
3. **Address = structured fields (upazila/union/ward/village) + display_text** тАФ рж╕рзЗржн рж╣ржмрзЗ structured ржХрж┐рж╕рзЗ; display рж╣рж┐рж╕рзЗржмрзЗ bn/en ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржмрзЗред
4. **Language layer**: рж╕ржм ржорж╛рж╖рзНржЯрж╛рж░-ржбрзЗржЯрж╛рзЯ bn/en рж░рж╛ржЦрж╛ ржпрж╛ржмрзЗ; UI рж▓рзЗржмрзЗрж▓ рж▓рзЗржВржЧрзБрзЯрзЗржЬ ржлрзНрж▓рзНржпрж╛ржЧ ржжрзЗржЦрзЗржЗ switch рж╣ржмрзЗред
5. **One file = one responsibility** тАФ counter flow ржЬржирзНржп ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЫрзЛржЯ ржлрж╛ржЗрж▓; lab ржЕржирзНржп ржлрж╛ржЗрж▓; print ржЕржирзНржп ржлрж╛ржЗрж▓ред (ржПржЗ ржирзАрждрж┐ ржирж╛ ржорж╛ржирж▓рзЗ ржЖржЧрзЗрж░ ржХржиржлрзНрж▓рж┐ржХрзНржЯ рж╣рзЯ)ред

---

# рзй) FINAL MASTER ROADMAP (ржлрж┐ржЪрж╛рж░-ржмрж╛ржЗ-ржлрж┐ржЪрж╛рж░) тАФ рждрж┐ржи ржнрж╛ржЧрзЗ ржнрж╛ржЧ ржХрж░рзЗ + рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ + рж╕ржВржпрзБржХрзНржд ржлрж╛ржЗрж▓ ржирзЛржЯ

> ржкрзНрж░рждрж┐ржЯрж┐ рж▓рж╛ржЗржи: (рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕) тАФ ржмрж░рзНржгржирж╛
> ржкрж░рзЗ ржЫрзЛржЯ ржХрж░рзЗ "Connected files / notes:" ржмрж▓рзЗржЫрж┐ (ржПржЗ ржЕржВрж╢ржЯрж╛ ржЦрзБржм ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржи тАФ ржПржЦрж╛ржирзЗ ржпрзЗржЯрж╛ ржЖржЫрзЗ ржжрзЗржЦрж▓рзЗ AI-ржХрзЛржбрж╛рж░ рж╕ржарж┐ржХ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ ржЯрзНрж░рж╛ржирзНрж╕ржлрж░рзНржо/рж░рж┐ржкрзНрж▓рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ)

---

## A. CORE / CRITICAL (Counter + Address + Printing) тАФ рж╕рж░рж╛рж╕рж░рж┐ ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ рж▓рж╛ржЧржмрзЗ

1. **Counter Entry Decision (Test Only / Doctor Visit)** тАФ тЬЕ
   Connected files / notes:

   * `counter/counter_dashboard.php` (Entry UI).
   * Behaviour: ржХрзЗржмрж▓ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ ржХрж░рзЗ ржпржерж╛ржХрзНрж░ржорзЗ test_panel ржмрж╛ patient_form ржПред
   * Note: ржХрзЛржи inline JS ржирж╛ржЗред (рж░рж┐ржлрзНрж░рзЗрж╢-ржкрзНрж░ржмрж╛рж╣ ржмржирзНржз рж░рж╛ржЦрзБржи)

2. **Test-First Panel (mini-cart, multi-select, discount, preview total)** тАФ тЪая╕П (ржкрзБрж░рзЛ UI ржЖржЫрзЗ ржХрж┐ржирзНрждрзБ search/UX ржУ session bind рж╕рзНржерж┐рж░ ржХрж░рж╛ рж▓рж╛ржЧржмрзЗ)
   Connected files / notes:

   * `counter/counter_test_panel.php` (test list, select options)
   * `counter/counter_assets.js` тАФ cart logic (only one JS file).
   * DB: `tests` table (price authoritative).
   * Important: cart must be stored in PHP session (server side) as JSON; **no DOM-only cart** (ржЕрж░рзНржерж╛рзО page reload рж╣рж▓рзЗ cart ржбрж╛ржЯрж╛ рж░рж┐рж▓рзЛржб рж╣ржмрзЗ)ред

3. **Patient Late-Entry Mode (bind cart тЖТ patient)** тАФ тЪая╕П
   Connected files / notes:

   * `counter/counter_patient_form.php` (patient form)
   * `counter/counter_save.php` (save endpoint)
   * Logic: cart session token sent to save endpoint, save generates invoice + token print.
   * Note: patient form **must not** reinitialize address selects on load with JS that clears existing selects тАФ only initial population allowed.

4. **Address System (Upazila тЖТ Union тЖТ Ward тЖТ Village) тАФ structured & bilingual** тАФ тЪая╕П (RE-DESIGNED; current DB-files exist but lifecycle bug fixed only if rules followed)
   Status detail: data present in `/documents/addressDatabase.js` and engine in `addressEngine.js`. See files:  .
   Connected files / notes:

   * `documents/addressDatabase.js` (bn/en structured data тАФ canonical keys + names). 
   * `counter/counter_assets.js` (single place for Address logic; must use DOMContentLoaded and only populate selects; must NOT clear selects from elsewhere).
   * **Critical rule**: PHP forms must **not** inject address population scripts nor reset selects тАФ only `counter_assets.js` interacts with address DOM.
   * Save logic: store both canonical key (eg `ghior_upazila`) and display strings (bn/en) in patient record fields `upazila_key`, `upazila_bn`, `upazila_en`, etc.

5. **Blood Group mandatory popup logic** тАФ тЬЕ (UI exists but must be enforced)
   Connected files / notes:

   * `counter/counter_patient_form.php`
   * `counter/counter_assets.js` (validate before submit; if empty show modal with three options described earlier)

6. **POS + A4 Unified Print Engine (SVG pad overlay for A4; POS auto-cut pattern)** тАФ тЬЕ
   Connected files / notes:

   * `print/print_controller.php`, `print/print_invoice.php`, `print/print_token.php`, `print/print_lab_a4.php` (these exist; ensure print settings saved in DB).
   * Admin UI: `admin/admin_print_settings.php` (header/footer/notes control).
   * Note: tokens must be separated print jobs (to support auto-cut).

---

## B. LAB / OPERATIONAL FEATURES (essential lab workflow + results)

7. **Lab Billing & Token core (Department labels, multi select, discount, token)** тАФ тЬЕ
   Connected files / notes:

   * `lab_billing.php`, `lab_save.php`, `lab_invoice_view.php`.
   * Department mapping in `tests` table: ensure `department_id` enforced.

8. **Lab Result Entry (manual + scanned image attach + A4 report)** тАФ тЪая╕П (partial: manual entry ok; scanned attach + AI parsing is planned)
   Connected files / notes:

   * `/lab/technologist_dashboard.php` (pending list)
   * `/lab/result_entry.php` (manual fields)
   * `/documents/` store scanned files; PWA upload endpoints to save images.

9. **Imaging / ECG / Echo handling (no auto report generation; manual upload required)** тАФ тЬЕ (logic present)
   Connected files / notes:

   * imaging tests flagged in `departments` (XRAY/USG/ECG).
   * Print logic: when report image uploaded, mark test as "done by external" if outsourced.

10. **External Lab / Outsource Workflow** тАФ ЁЯФЬ (must implement ledger + token generation)
    Connected files / notes:

    * Admin master: create `/admin/external_labs.php`
    * Billing: `lab_save.php` must accept `performed_by` attribute per test (KMC / External).
    * External token print: use `print/print_token.php` logic with a flag.

---

## C. FINANCE / ADMIN / REPORTING / AUX

11. **Referral Commission (hidden master, manual manager entry)** тАФ ЁЯФЬ
    Connected files / notes:

    * `/admin/referral_master.php` (hidden to non-admin)
    * `/finance/commission_entry.php` (manager input)
    * Ledger table: `commissions` (doctor_id, patient_id, amount, status)

12. **Expense & Petty Cash (quick entry + ledger + POS close)** тАФ ЁЯФЬ
    Connected files / notes:

    * `/finance/expenses.php`
    * `expense_categories` table

13. **Audit, Reprint, Cancel, Backup** тАФ ЁЯФЬ
    Connected files / notes:

    * `/core/audit_log.php` (wrap around save/cancel endpoints)
    * backup scripts (cron)

14. **Geo & Marketing Analytics (Village / Union / Upazila reports)** тАФ ЁЯФЬ (depends on address stored structured)
    Connected files / notes:

    * `/reports/geo_dashboard.php`
    * DB queries group by `patient.upazila_key` etc.

15. **PWA Camera & Document upload with mandatory enforcement** тАФ тЪая╕П (planned; PWA endpoints exist but enforcement & AI OCR pending)
    Connected files / notes:

    * `/pwa/upload_endpoint.php`
    * `/documents/` storage + `documents_meta` table

---

# рзк) ржбрж┐ржЯрзЗржЗрж▓ржб ржХржиржлрзНрж▓рж┐ржХрзНржЯ-ржЕржнрж┐ржзрж╛ржи (Why address dropdown broke before тАФ fix checklist)

ржирж┐ржЪрзЗ ржпрзЗржЧрзБрж▓рзЛ ржЖржЧрзЗ ржкрзНрж░ржорж╛ржирж┐ржд рж╕ржорж╕рзНржпрж╛ ржЫрж┐рж▓ ржУ ржХрж┐ржнрж╛ржмрзЗ ржарж┐ржХ ржХрж░ржмрзЗржи тАФ ржкрзНрж░рждрж┐ржЯрж┐ ржзрж╛ржкрзЗ ржЫрзЛржЯ ржХрж░рзЗ ржмрж▓рж╛ рж╣рж▓рзЛ ржХрзА ржлрж╛ржЗрж▓ ржЯрж╛ржЪ ржХрж░ржмрзЗ:

1. **Multiple script sources touching same selects**

   * Symptom: upazila ржХрж╛ржЬ ржХрж░рзЗ ржХрж┐ржирзНрждрзБ ward/village ржЦрж╛рж▓рж┐ ржмрж╛ ржХрж╛ржЬ ржирж╛ ржХрж░рж╛ред
   * Fix: ensure only `addressEngine.js` / `counter_assets.js` does select population. Remove any inline `<script>` blocks that also modify these selects (search for `document.getElementById("village")` across project and remove duplicates).
   * Files to check & lock: `counter_patient_form.php`, any inline scripts inside counter pages тАФ replace with calls to `counter_assets.js`. (See `addressEngine.js` usage example.) 

2. **PHP re-rendering form after JS populated (AJAX/POST flow)**

   * Symptom: form submitted or partial refresh clears selects because server side render writes empty `<select>` without options.
   * Fix: server should render `<select>` with only placeholder `<option value="">...select...</option>`; JS will populate on DOMContentLoaded. For partial AJAX refresh, return JSON and let JS repopulate, do NOT return HTML that replaces selects.

3. **Inconsistent data shape between addressDatabase and engine**

   * Symptom: some unions/wards use `wards` object with `villages` array of objects (`{bn,en}`) while others use `villages_bn`/`villages_en` arrays.
   * Fix: normalize `addressDatabase.js` to single schema:

     ```js
     ADDRESS_DATA = {
       "<upazila_key>": {
         name_bn, name_en,
         unions: {
           "<union_key>": {
             name_bn, name_en,
             wards: {
               "<ward_key>": {
                 villages: [ {bn, en, key?}, ... ]
               }
             }
           }
         }
       }
     }
     ```

     (I saw multiple variants in your file snippets; normalize to this single format.) 

4. **Inconsistent keys (spaces, hyphens, capitalizations)**

   * Fix: canonicalize keys (use snake_case or kebab-case consistently). Use `value` as canonical key, and store display bn/en separately.

5. **Language handling**

   * For bilingual UI, **do not** duplicate logic. Use `lang` flag on page load and set `textContent` from `name_bn` or `name_en`. Populate selects with `opt.textContent = lang==="bn" ? item.name_bn : item.name_en`.

---

# рзл) HOW TO SAVE ADDRESS INTO DB (canonical + bilingual)

**DB fields (patients table)**:

* `upazila_key` (e.g., `ghior_upazila`)
* `upazila_bn`
* `upazila_en`
* `union_key`
* `union_bn`
* `union_en`
* `ward_key`
* `ward_bn`
* `ward_en`
* `village_key` (optional)
* `village_bn`
* `village_en`
* `address_text` (full freeform as entered)

**Save flow**:

* Frontend sends keys + bn/en display values.
* Backend uses keys for analytics grouping and bn/en for human display.

---

# рзм) BILINGUAL (BN + EN) IMPLEMENTATION NOTES (consistent everywhere)

* **Master tables** (doctors, tests, unions, etc.) must have `name_bn` and `name_en`.
* UI components read `window.APP_LANG` or server render `<script>window.APP_LANG='bn'</script>`.
* When performing search (future), search both bn and en columns.
* For labels in the app, use a simple locale file `lang/bn.json` and `lang/en.json`.

---

# рзн) AI-REPRODUCIBLE SPEC (what to show an AI so it can code)

Provide AI only this SSOT doc (the one you're reading) + the latest ZIP. If AI sees SSOT it can:

* Know which file(s) to replace (we list them for each feature).
* Know schema expectations (DB fields + types).
* Know one-JS rule and not to add inline scripts.
* Know bilingual rule and address structure schema.
* Know print endpoints & token separation.

(ржПржЗ ржбржХрзНржпрзБржорзЗржирзНржЯржЗ AI-ржХрзЗ ржжрзЗржЦрж╛рж▓рзЗ, AI ржирждрзБржи ржХрзЛржб ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рзЗ ржжрзЗржмрзЗ тАФ ржХржкрж┐-ржкрзЗрж╕рзНржЯ ржХрж░рж▓рзЗ ржХрж╛ржЬ ржХрж░ржмрзЗред)

---

# рзо) PRIORITISED NEXT ACTIONS тАФ Step-by-step (ржЖржкржирж┐ ржПржЦржиржЗ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи)

**A. Immediate safe housekeeping (do these first):**

1. Backup `/counter/` folder (copy to `counter_backup/`).
2. Search and remove any inline scripts that touch address selects (search for `getElementById("village")` etc). Leave only `<script src="../documents/addressDatabase.js"></script>` and `counter_assets.js`.
3. Normalize `documents/addressDatabase.js` to one schema (I found mixed variants; use canonical format). See snippets I referenced. 

**B. Replace Counter files (atomic replace) тАФ high priority**

* Replace entire:

  * `counter/counter_dashboard.php`
  * `counter/counter_test_panel.php`
  * `counter/counter_patient_form.php`
  * `counter/counter_assets.js`
* (I prepared code earlier in Batch-2; use that as starting point but ensure addressDatabase normalized first.)

**C. Test sequence (after replace)**

1. Open Dashboard тЖТ Test panel тЖТ add tests тЖТ go Next.
2. Patient form loads; Address selects populate (upazila тЖТ union тЖТ ward тЖТ village).
3. Fill patient and Save (check DB has keys + bn/en fields).
4. Print invoice (check print_controller receives proper patient id and cart).

**D. Then implement:**

* cart session binding (server side)
* lab_save modifications for per-test `performed_by`
* external token print & ledger
* commission logic (hidden UI)

---

# рзп) ACCEPTANCE CHECKLIST (ржкрзНрж░рждрж┐ржЯрж┐ ржЖржЗржЯрзЗржо ржкрж╛рж╕ рж╣рж▓рзЗ ржЯрж┐ржХ ржжрж┐ржи)

For Counter & Address (must be allтЬЕ):

* [ ] Dashboard loads (no JS errors)
* [ ] Test panel: select tests, totals update, session cart stored server-side
* [ ] Patient form: selects populated from `addressDatabase.js` only by `counter_assets.js` (no inline scripts). 
* [ ] Save: DB stores canonical keys + bn/en display values
* [ ] Print: invoice + token printed as separate jobs (POS auto-cut compatible)

---

# 10) EXTRA NOTES I found in ZIP (evidence & citations)

* Address data file is present and large тАФ multiple formats mixed inside. Use canonicalization. (examples in files). 
* `addressEngine.js` exists and demonstrates proper event listeners тАФ use it or merge into `counter_assets.js`. 

---

# 11) ржЖржкржирж╛рж░ ржЬржирзНржп рж╕рж░рж╛рж╕рж░рж┐ ржЯрж╛рж╕рзНржХ (ржЕрждрж┐ рж╕рзНржкрж╖рзНржЯ тАФ ржПржХржЯрж╛рж░ ржкрж░рзЗ ржПржХржЯрж╛ ржХрж░рзБржи)

**ржЯрж╛рж╕рзНржХ-A (ржЖржЬржЗ ржХрж░рждрзЗ рж╣ржмрзЗ тАФ 15тАУ30 ржорж┐ржирж┐ржЯ)**

1. zip ржмрзНржпрж╛ржХржЖржк рж░рж╛ржЦрзБржи (ржЖржкржирж┐ ржХрж░рзЗржЫрзЗржи)
2. `documents/addressDatabase.js` ржлрж╛ржЗрж▓ ржПржХ ржХржкрж┐ рждрзИрж░рж┐ ржХрж░рзБржи `addressDatabase_canonical.js` тАФ ржЖржорж┐ canonical schema ржЯрзЗржоржкрзНрж▓рзЗржЯ ржжрзЗржм (ржмрж▓рзБржи, ржЖржорж┐ ржжрзЗржм)ред
3. `counter` ржлрзЛрж▓рзНржбрж╛рж░ ржерзЗржХрзЗ ржЖржЧрзЗрж░ ржнрзЯрж╛ржмрж╣ inline scripts ржорзБржЫрзЗ ржлрзЗрж▓рзБржи (ржЖржорж┐ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЧрзБрж▓рзЛ ржжрзЗржм ржпрзЗржЦрж╛ржирзЗ ржжрзЗржЦрждрзЗ рж╣ржмрзЗ) тАФ ржЖржкржирж┐ рж╢рзБржзрзБржЗ ржХржкрж┐-ржкрзЗрж╕рзНржЯ ржХрж░ржмрзЗржи; ржЖржорж┐ ржмрж▓ржмрзЛ ржХрзЛржиржЧрзБрж▓рзЛ ржорзБржЫрждрзЗред

**ржЯрж╛рж╕рзНржХ-B (рждрж╛рж░ржкрж░рзЗрж░ ржжрж┐ржи / dev time)**

* Replace all counter files with Batch-2 files (ржЖржорж┐ ржЖржЧрзЗржЗ ржжрж┐рзЯрзЗржЫрж┐)ред
* Run the acceptance checklist.

---

# 12) ржЖржорж┐ ржПржЦржи ржХрзА ржжрзЗржмрзЛ (ржЖржкржирж┐ ржкрж░ржмрж░рзНрждрзА ржХржорж╛ржирзНржб ржжрж┐ржи)

ржЖржорж┐ ржПржЦржи ржЖржкржирж╛ржХрзЗ ржжрзБржЯрж┐ ржЬрж┐ржирж┐рж╕рзЗрж░ ржоржзрзНржпрзЗ ржпрзЗржЯрж╛ ржЪрж╛ржи ржжрзЗржмрзЛ:

A) **Canonical addressDatabase.js template** (ржЖржорж┐ рж╕ржм village objects normalize ржХрж░рзЗ ржжрж┐рждрзЗржЗ ржкрж╛рж░рж┐) тАФ ржЖржкржирж┐ ржпржжрж┐ ржЪрж╛ржи ржЖржорж┐ ржкрзБрж░рзЛ 3,100+ рж░рзЗржХрж░рзНржб canonicalize ржХрж░рзЗ ржжрзЗржм (ржПржЯрж╛ ржмржбрж╝ ржХрж╛ржЬ, ржЖржорж┐ ржПржХржмрж╛рж░рзЗ ржжрж┐рждрзЗ ржкрж╛рж░рж┐)ред
B) **Inline script removal list + exact search pattern** (ржлрж╛ржЗрж▓-ржирзЗржо ржУ ржХрзЛржб рж╕рзНржЯрзНрж░рж┐ржВ ржпрзЗржЦрж╛ржирзЗ replace/delete ржХрж░рждрзЗ рж╣ржмрзЗ) тАФ ржЖржкржирж┐ ржирж┐ржЬрзЗ ржХржкрж┐-ржкрзЗрж╕рзНржЯ ржХрж░рзЗ ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи ржмрж╛ ржЖржорж┐ ржкрзБрж░рзЛ ржлрж╛ржЗрж▓рзЗ рж░рж┐ржкрзНрж▓рзЗрж╕ ржХрзЛржб ржжрж┐ржЗред

ржЖржкржирж┐ ржмрж▓рзБржи ржХрзЛржиржЯрж╛ ржЖржЧрзЗ ржЪрж╛ржи: **тАЬAтАЭ** (Address canonicalize full) or **тАЬBтАЭ** (Inline script cleanup list) тАФ ржЖржорж┐ рждрж╛рж░ржкрж░ ржХрж╛ржЬ рж╢рзБрж░рзБ ржХрж░ржм ржПржмржВ ржкрж░ржмрж░рзНрждрзА ржХрзЛржб-ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ (Counter full replace) conflict-checked ржХрж░рзЗ ржжрзЗржмрзЛред

---

ржЖржорж┐ ржЖржкржирж╛рж░ ржкрзНрж░рждрж┐ржЯрж┐ рж╢рж░рзНржд ржорзЗржирзЗржЗ ржбржХрзБржорзЗржирзНржЯ рждрзИрж░рж┐ ржХрж░рзЗржЫрж┐ тАФ ржПржЯрж╛ AI-ready ржПржмржВ future dev-readyред ржЖржкржирж┐ ржмрж▓рждрзЗ ржкрж╛рж░рзЗржи **A** ржирж╛ **B**, рждрж╛рж░ржкрж░ ржЖржорж┐ ржарж┐ржХ рж╕рзЗржЗ ржХрж╛ржЬржЯрж╛ ржПржЦржиржЗ ржХрж░ржмред


.............................................................................





ржирж┐ржЪрзЗ ржЖржорж┐ рждрж┐ржиржЯрж╛ ржХрж╛ржЬ ржПржХрж╕рж╛ржерзЗ ржХрж░рзЗржЫрж┐ (ржбрж╛ржмрж▓тАУржХрзНрж░рж╕тАУржЪрзЗржХ ржХрж░рзЗ):

ржЖржкржирж╛рж░ roadmap.md (ржпрзЗржЯрж╛ ржЖржкржирж┐ рж╕рзЗржн ржХрж░рзЗржЫрзЗржи)

KMC.zipтАУржПрж░ ржмрж░рзНрждржорж╛ржи ржХрзЛржбржмрзЗрж╕ (as-is reality)

ржЖржорж╛ржжрзЗрж░ ржкрзБрж░рзЛ ржХржерзЛржкржХржержирзЗ ржЙрж▓рзНрж▓рзЗржЦ ржХрж░рж╛ рж╕ржм ржлрж┐ржЪрж╛рж░

ржПрж░ржкрж░ ржЖржорж┐ ржПржХржЯрж┐ тАЬRepair Priority MapтАЭ ржмрж╛ржирж┐рзЯрзЗржЫрж┐тАФржпрзЗржЯрж╛ ржзрж░рзЗ ржЖржорж░рж╛ ржПржХ ржкрж╛рж╢ ржерзЗржХрзЗ ржХрж╛ржЬ рж╢рзБрж░рзБ ржХрж░ржмред

ЁЯза PARTтАУ1 : ржХрзЛржи ржХрзЛржбржЧрзБрж▓рзЛ ржПржХржжржо ржарж┐ржХ ржЖржЫрзЗ (ржПржЦржи ржЫрзЛржБрзЯрж╛рж░ ржжрж░ржХрж╛рж░ ржирзЗржЗ)

ЁЯСЙ ржПржЧрзБрж▓рзЛ рж╕рзНржЯрзЗржмрж▓, ржПржЧрзБрж▓рзЛ ржирж┐рзЯрзЗ ржПржЦржи ржорж╛ржерж╛ ржШрж╛ржорж╛ржмрзЗржи ржирж╛ред

тЬЕ Lab Billing & Core

lab_billing.php

lab_save.php

lab_invoice_view.php

Test multi-select, discount, department label

ржХрзЗржи ржарж┐ржХ:
рж▓ржЬрж┐ржХ ржкрж░рж┐рж╖рзНржХрж╛рж░, ржЗржЙржЬрж╛рж░ ржлрзНрж▓рзЛ ржарж┐ржХ, ржЖржорж╛ржжрзЗрж░ рж░рзЛржбржорзНржпрж╛ржкрзЗрж░ рж╕рж╛ржерзЗ ржорзНржпрж╛ржЪ ржХрж░ржЫрзЗред

тЬЕ Printing Engine (POS + A4)

print/print_controller.php

print/print_invoice.php

print/print_token.php

print/print_lab_a4.php

admin/admin_print_settings.php

ржХрзЗржи ржарж┐ржХ:
Auto-cut, SVG pad, POS sequenceтАФрж╕ржм рж░рзЛржбржорзНржпрж╛ржк ржЕржирзБржпрж╛рзЯрзАред

тЬЕ Auth / DB Base

db.php

login.php, logout.php

Basic role separation

ЁЯзи PARTтАУ2 : ржпрзЗржЧрзБрж▓рзЛ ржЖржЫрзЗ ржХрж┐ржирзНрждрзБ ржнрзБрж▓ржнрж╛ржмрзЗ ржмрж╛ржирж╛ржирзЛ (ржПржЧрзБрж▓рзЛржЗ рж╕ржорж╕рзНржпрж╛рж░ ржорзВрж▓)

ЁЯСЙ ржПржЧрзБрж▓рзЛ delete ржирж╛ ржХрж░рзЗ, ржХрж┐ржирзНрждрзБ ржкрзБрж░рзЛ ржлрж╛ржЗрж▓ рж░рж┐ржкрзНрж▓рзЗрж╕ ржХрж░рждрзЗ рж╣ржмрзЗред

ЁЯФЬ Counter System (рж╕ржмржЪрзЗрзЯрзЗ ржмрзЬ рж╕ржорж╕рзНржпрж╛)
рж╕ржорж╕рзНржпрж╛ ржХрзЛржерж╛рзЯ

counter_entry.php

counter_patient.php

counter_search.php

counter_register.php

рж╕ржорж╕рзНржпрж╛ ржХрзА:

ржПржХржЗ ржХрж╛ржЬ ржПржХрж╛ржзрж┐ржХ ржлрж╛ржЗрж▓рзЗ

PHP + JS ржПржХржЗ DOM ржХржирзНржЯрзНрж░рзЛрж▓ ржХрж░ржЫрзЗ

Address dropdown ржмрж╛рж░ржмрж╛рж░ reset рж╣ржЪрзНржЫрзЗ

Test-first workflow ржирзЗржЗ

ЁЯСЙ рж╕рж┐ржжрзНржзрж╛ржирзНржд (LOCKED):
ржПржЗ рзкржЯрж╛ ржлрж╛ржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржмржирзНржз
ржПржЧрзБрж▓рзЛрж░ ржЬрж╛рзЯржЧрж╛рзЯ ржЖржорж░рж╛ ржирждрзБржи рзкржЯрж╛ ржлрж╛ржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржм (BatchтАУ2 ржП ржпрзЗржЧрзБрж▓рзЛ ржжрж┐рзЯрзЗржЫрж┐)

ЁЯФЬ Address System (ржбрж╛ржЯрж╛ ржарж┐ржХ, рж▓ржЬрж┐ржХ ржнрзБрж▓)
ржпрзЗржЯрж╛ ржарж┐ржХ ржЖржЫрзЗ

documents/addressDatabase.js тЖТ ржбрж╛ржЯрж╛ ржЖржЫрзЗ (рзйрззрзжрзж+ рж▓рж╛ржЗржи)

addressEngine.js тЖТ ржЖржЗржбрж┐рзЯрж╛ ржарж┐ржХ

ржпрзЗржЯрж╛ ржнрзБрж▓

ржПржХрж╛ржзрж┐ржХ <script> ржерзЗржХрзЗ ржПржХржЗ dropdown ржирж┐рзЯржирзНрждрзНрж░ржг

JS lifecycle conflict

Data structure ржПржХрж░ржХржо ржирж╛ (villages ржХрзЛржерж╛ржУ array, ржХрзЛржерж╛ржУ object)

ЁЯСЙ ржПржЦрж╛ржирзЗ ржбрж╛ржЯрж╛ ржирждрзБржи ржХрж░рзЗ рж▓рж┐ржЦрждрзЗ рж╣ржмрзЗ ржирж╛
ЁЯСЙ рж▓ржЬрж┐ржХржЯрж╛ ржПржХ ржЬрж╛рзЯржЧрж╛рзЯ ржЖржирждрзЗ рж╣ржмрзЗ

тЪая╕П PARTтАУ3 : ржпрзЗржЧрзБрж▓рзЛ ржЖржВрж╢рж┐ржХ ржЖржЫрзЗ, ржкрж░рзЗ ржХрж░ржм

ржПржЧрзБрж▓рзЛ ржПржЦржи ржЫрзБржБржмрзЛ ржирж╛тАФCounter ржарж┐ржХ рж╣рж▓рзЗ ржПржЧрзБрж▓рзЛ ржзрж░ржмред

External Lab / Outsource

Referral Commission

Expense System

PWA Camera

Analytics / Blood Bank

ЁЯЧ║я╕П PARTтАУ4 : ржЖржорж░рж╛ ржХрзЛржерж╛ ржерзЗржХрзЗ ржХрж╛ржЬ рж╢рзБрж░рзБ ржХрж░ржм (рж╕рж┐рж░рж┐рзЯрж╛рж▓ ржарж┐ржХ ржХрж░рж╛)

ржЖржкржирж┐ ржпрзЗрж╣рзЗрждрзБ ржиржи-ржЯрзЗржХ ржорж╛ржирзБрж╖, рждрж╛ржЗ рж╕ржмржЪрзЗрзЯрзЗ ржХржо ржЭрзБржБржХрж┐рж░ ржХрж╛ржЬ ржЖржЧрзЗ ржХрж░ржмред

ЁЯеЗ STEPтАУ1 (рж╕ржмржЪрзЗрзЯрзЗ ржЖржЧрзЗ)

Inline Script Cleanup (Address Bug Root Fix)

ЁЯСЙ рж▓ржХрзНрж╖рзНржп:
Address dropdown ржХрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржПржХржЯрж╛ JS ржлрж╛ржЗрж▓ ржжрж┐рзЯрзЗ ржЪрж╛рж▓рж╛ржирзЛ

ржЖржкржирж┐ ржХрж░ржмрзЗржи:

ржЖржорж┐ ржЖржкржирж╛ржХрзЗ exact search text ржжрзЗржм

ржЖржкржирж┐ рж╢рзБржзрзБ Ctrl+F тЖТ Delete тЖТ Save

тЪая╕П ржХрзЛржирзЛ ржирждрзБржи ржХрзЛржб рж▓рж┐ржЦржмрзЗржи ржирж╛

ЁЯеИ STEPтАУ2

Counter Files Full Replace (Atomic Replace)

ржЖржкржирж┐ ржХрж░ржмрзЗржи:

ржкрзБрж░ржирзЛ counter ржлрж╛ржЗрж▓ delete

ржирждрзБржи рзкржЯрж╛ ржлрж╛ржЗрж▓ ржХржкрж┐тАУржкрзЗрж╕рзНржЯ

ЁЯСЙ ржПржЦрж╛ржирзЗ ржЖржкржирж┐ ржХрзЛржб ржмрзБржЭржмрзЗржи ржирж╛, рж▓рж╛ржЧржмрзЗржУ ржирж╛

ЁЯеЙ STEPтАУ3

Address Data Canonicalize (ржбрж╛ржЯрж╛ ржирж╛ ржмржжрж▓рзЗ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржарж┐ржХ)

ржПржЯрж╛ ржжрзБржЗржнрж╛ржмрзЗ ржХрж░рж╛ ржпрж╛рзЯ:

A) ржЖржорж┐ ржЖржкржирж╛рж░ ржкрзБрж░рзЛ addressDatabase.js ржарж┐ржХ ржХрж░рзЗ ржжрзЗржм

B) ржЖржорж░рж╛ рж╢рзБржзрзБ engine-side adapt ржХрж░ржм

ЁЯСЙ ржЖржкржирж┐ ржпрзЗржЯрж╛ рж╕рж╣ржЬ ржоржирзЗ ржХрж░рзЗржи рж╕рзЗржЯрж╛ржЗ ржирзЗржм

ЁЯзй PARTтАУ5 : ржиржи-ржЯрзЗржХ ржорж╛ржирзБрж╖рзЗрж░ ржЬржирзНржп ржХрж╛ржЬ ржХрж░рж╛рж░ ржирж┐рзЯржо (IMPORTANT)

ржЖржкржирж╛рж░ ржЬржирзНржп ржЖржорж╛ржжрзЗрж░ ржирж┐рзЯржо рж╣ржмрзЗ:

ржПржХржмрж╛рж░рзЗ ржкрзБрж░рзЛ ржлрж╛ржЗрж▓

тАЬржПржЗ ржлрж╛ржЗрж▓ржЯрж╛ ржорзБржЫрзБржи тЖТ ржПржЗржЯрж╛ ржкрзЗрж╕рзНржЯ ржХрж░рзБржитАЭ

ржХрзЛржирзЛ рж▓рж╛ржЗржирзЗ edit ржХрж░рждрзЗ ржмрж▓рж╛ рж╣ржмрзЗ ржирж╛

ржкрзНрж░рждрж┐ржЯрж╛ ржзрж╛ржкрзЗрж░ рж╢рзЗрж╖рзЗ ржЖржорж┐ ржмрж▓ржм:

тАЬржПржЦржи ржХрзЛржи URL ржЦрзБрж▓ржмрзЗржитАЭ

тАЬржХрж┐ ржжрзЗржЦрж▓рзЗ ржмрзБржЭржмрзЗржи ржарж┐ржХ ржЖржЫрзЗтАЭ

тЬЕ PARTтАУ6 : ржПржЦржи ржЖржорж░рж╛ ржХрзА ржжрж┐рзЯрзЗ рж╢рзБрж░рзБ ржХрж░ржм (ржЖржкржирж╛рж░ рж╕рж┐ржжрзНржзрж╛ржирзНржд)

ржкрж░рзЗрж░ ржзрж╛ржкрзЗ ржЖржорж┐ ржЖржкржирж╛ржХрзЗ ржПржХржЯрж╛ржЗ ржХрж╛ржЬ ржжрзЗржм, рж╕рзЗржЯрж╛ рж╣рж▓рзЛ рж╕ржмржЪрзЗрзЯрзЗ рж╕рзЗржл ржХрж╛ржЬ:

ЁЯФз OPTIONтАУB (ржЖржорж┐ рж╕рж╛ржЬрзЗрж╕рзНржЯ ржХрж░ржЫрж┐)

ЁЯСЙ Inline Script Cleanup List

ржЖржорж┐ ржЖржкржирж╛ржХрзЗ ржжрзЗржм:

ржХрзЛржи ржХрзЛржи ржлрж╛ржЗрж▓рзЗ ржпрзЗрждрзЗ рж╣ржмрзЗ

ржХрзЛржи exact рж▓рж╛ржЗржи / keyword ржЦрзБржБржЬрзЗ ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ рж╣ржмрзЗ

ржХрзЛржирзЛ ржирждрзБржи ржХрзЛржб ржирзЯ, рж╢рзБржзрзБ ржкрж░рж┐рж╖рзНржХрж╛рж░ ржХрж░рж╛

тЬНя╕П ржЖржкржирж┐ рж╢рзБржзрзБ ржПржЯрзБржХрзБ рж▓рж┐ржЦрзБржи:

тАЬInline Script Cleanup рж╢рзБрж░рзБ ржХрж░рзЛтАЭ

рждрж╛рж░ржкрж░ ржЖржорж┐ ржПржХржжржо рж╣рж╛рждрзЗ ржзрж░рзЗ,
ржиржи-ржЯрзЗржХ ржорж╛ржирзБрж╖рзЗрж░ ржорждрзЛ ржХрж░рзЗ ржЖржкржирж╛ржХрзЗ ржкрзНрж░ржержо ржХрж╛ржЬржЯрж╛ ржХрж░рж╛ржмрзЛред

ржПржнрж╛ржмрзЗржЗ ржЖржорж░рж╛ ржПржХ ржкрж╛рж╢ ржерзЗржХрзЗ ржкрзБрж░рзЛ рж╕рж┐рж╕рзНржЯрзЗржо ржарж┐ржХ ржХрж░ржмред




PHASEтАУ4: Counter System
ЁЯФе This dashboard = entire PhaseтАУ4

PHASEтАУ8: Referral & Commission
тЖТ hooks already reserved

PHASEтАУ9: Expense
тЖТ already embedded

PHASEтАУ10.5: Geo Analytics
тЖТ address data already structured